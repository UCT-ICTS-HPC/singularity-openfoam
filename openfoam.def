Bootstrap: library
From: ubuntu:18.04
Stage: build

%labels

    APPLICATION_NAME OpenFoam
    OS_VERSION Ubuntu 18.04
    APPLICATION_URL OpenFoam

    SYSTEM_NAME UCT ICTS HPC 
    SYSTEM_SINGULARITY_VERSION 3.2
    SYSTEM_URL http://hpc.uct.ac.za

    AUTHOR_NAME Timothy Carr
    AUTHOR_EMAIL timothy.carr@uct.ac.za

%environment
    # Set system locale
    export LC_ALL=C
    export OMPI_MCA_btl_vader_single_copy_mechanism=none
    export PATH=$PATH:/opt/openfoam7/bin

%post

    # Update Ubuntu Cache and begin install
    apt update -y
    apt install -y software-properties-common
    apt-add-repository universe
    export DEBIAN_FRONTEND=noninteractive; apt-get -y update --allow-unauthenticated \
    && apt-get install -y --allow-unauthenticated \
        vim\
        wget\
        software-properties-common\
        gpg-agent
	rm -rf /var/lib/apt/lists/*
    
    # OpenFoam Installation and Configuration without ParaView
    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 6C0DAC728B29D817
    sh -c "wget -O - http://dl.openfoam.org/gpg.key | apt-key add -"
	add-apt-repository http://dl.openfoam.org/ubuntu
	apt-get update
	apt-get install -y --no-install-recommends openfoam7
	rm -rf /var/lib/apt/lists/*

    # Set the environment for OpenFoam Users
    echo ". /opt/openfoam7/etc/bashrc" >> $SINGULARITY_ENVIRONMENT

    # Clean Up 
    apt clean
    apt autoclean
    apt autoremove -y 

%help 
    This is a OpenFoam 7 container. 


%test
    # The following tests will be used to test the functionality of the container build
    # and the results fed into the CI Jenkins platform